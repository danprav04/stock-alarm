2025-05-25 21:08:38,803 - root - INFO - main:113 - ===================================================================
2025-05-25 21:08:38,803 - root - INFO - main:114 - Starting Financial Analysis Script at 2025-05-25 18:08:38 UTC
2025-05-25 21:08:38,803 - root - INFO - main:115 - ===================================================================
2025-05-25 21:08:38,805 - root - INFO - main:16 - --- Starting Individual Stock Analysis for: ['NKE'] ---
2025-05-25 21:08:40,468 - root - INFO - base_client:38 - Cache hit for: GET:https://financialmodelingprep.com/api/v3/profile/NKE?apikey=62ERGmJoqQgGD0nSGxRZS91TVzfz61uB...
2025-05-25 21:08:42,052 - root - INFO - stock_analyzer:122 - Fetched profile from FMP for NKE.
2025-05-25 21:08:42,052 - root - INFO - stock_analyzer:162 - Stock entry for NKE (ID: 1, CIK: 0000320187) ready.
2025-05-25 21:08:42,052 - root - INFO - stock_analyzer:598 - Full analysis pipeline started for NKE...
2025-05-25 21:08:42,053 - root - WARNING - stock_analyzer:646 - Stock NKE (ID: 1) DETACHED or bound to DIFFERENT session. Attempting to merge.
2025-05-25 21:08:42,303 - root - INFO - stock_analyzer:649 - Successfully merged stock NKE (ID: 1) into current session.
2025-05-25 21:08:42,303 - root - INFO - stock_analyzer:165 - Fetching financial statements for NKE...
2025-05-25 21:08:42,390 - root - INFO - base_client:38 - Cache hit for: GET:https://financialmodelingprep.com/api/v3/income-statement/NKE?apikey=62ERGmJoqQgGD0nSGxRZS91TVzf...
2025-05-25 21:08:44,231 - root - INFO - base_client:38 - Cache hit for: GET:https://financialmodelingprep.com/api/v3/balance-sheet-statement/NKE?apikey=62ERGmJoqQgGD0nSGxRZ...
2025-05-25 21:08:46,067 - root - INFO - base_client:38 - Cache hit for: GET:https://financialmodelingprep.com/api/v3/cash-flow-statement/NKE?apikey=62ERGmJoqQgGD0nSGxRZS91T...
2025-05-25 21:08:47,651 - root - INFO - stock_analyzer:171 - FMP Annuals for NKE: Income(5), Balance(5), Cashflow(5).
2025-05-25 21:08:48,722 - root - WARNING - base_client:122 - HTTP error on attempt 1/3 for GET https://financialmodelingprep.com/api/v3/income-statement/NKE (Params: {'apikey': '62ER******61uB', 'period': 'quarter', 'limit': 8}, Headers: {}): 403 - {
  "Error Message": "Exclusive Endpoint : This endpoint is not available under your current subscription agreement, please visit our subscription page to upgrade your plan or contact us at https://si...
2025-05-25 21:08:48,722 - root - ERROR - base_client:140 - Client error 403 (Unauthorized/Forbidden) for https://financialmodelingprep.com/api/v3/income-statement/NKE. API key may be invalid or permissions lacking. No retry. Params: {'apikey': '62ER******61uB', 'period': 'quarter', 'limit': 8}
2025-05-25 21:08:50,224 - root - INFO - stock_analyzer:173 - FMP Quarterly Income for NKE: 0 records.
2025-05-25 21:08:50,896 - root - INFO - base_client:38 - Cache hit for: GET:https://finnhub.io/api/v1/stock/financials-reported?count=8&freq=quarterly&symbol=NKE&token=d0o7...
2025-05-25 21:08:52,482 - root - INFO - stock_analyzer:175 - Fetched 45 quarterly reports from Finnhub for NKE.
2025-05-25 21:08:52,896 - root - INFO - base_client:38 - Cache hit for: GET:https://www.alphavantage.co/query?apikey=HB6N4X55UTFGN2FP&function=INCOME_STATEMENT&symbol=NKE...
2025-05-25 21:09:07,980 - root - INFO - stock_analyzer:178 - Fetched 81 quarterly income reports from Alpha Vantage for NKE.
2025-05-25 21:09:08,477 - root - INFO - base_client:38 - Cache hit for: GET:https://www.alphavantage.co/query?apikey=HB6N4X55UTFGN2FP&function=BALANCE_SHEET&symbol=NKE...
2025-05-25 21:09:23,560 - root - INFO - stock_analyzer:181 - Fetched 81 quarterly balance reports from Alpha Vantage for NKE.
2025-05-25 21:09:24,059 - root - INFO - base_client:38 - Cache hit for: GET:https://www.alphavantage.co/query?apikey=HB6N4X55UTFGN2FP&function=CASH_FLOW&symbol=NKE...
2025-05-25 21:09:39,144 - root - INFO - stock_analyzer:184 - Fetched 81 quarterly cash flow reports from Alpha Vantage for NKE.
2025-05-25 21:09:39,144 - root - INFO - stock_analyzer:191 - Fetching key metrics and profile for NKE.
2025-05-25 21:09:39,392 - root - INFO - base_client:38 - Cache hit for: GET:https://financialmodelingprep.com/api/v3/key-metrics/NKE?apikey=62ERGmJoqQgGD0nSGxRZS91TVzfz61uB...
2025-05-25 21:09:42,011 - root - WARNING - base_client:122 - HTTP error on attempt 1/3 for GET https://financialmodelingprep.com/api/v3/key-metrics/NKE (Params: {'apikey': '62ER******61uB', 'period': 'quarterly', 'limit': 8}, Headers: {}): 403 - {
  "Error Message": "Exclusive Endpoint : This endpoint is not available under your current subscription agreement, please visit our subscription page to upgrade your plan or contact us at https://si...
2025-05-25 21:09:42,012 - root - ERROR - base_client:140 - Client error 403 (Unauthorized/Forbidden) for https://financialmodelingprep.com/api/v3/key-metrics/NKE. API key may be invalid or permissions lacking. No retry. Params: {'apikey': '62ER******61uB', 'period': 'quarterly', 'limit': 8}
2025-05-25 21:09:44,096 - root - INFO - base_client:38 - Cache hit for: GET:https://finnhub.io/api/v1/stock/metric?metric=all&symbol=NKE&token=d0o7hphr01qqr9alj38gd0o7hphr0...
2025-05-25 21:09:45,680 - root - INFO - stock_analyzer:199 - FMP KM Annual for NKE: 5. FMP KM Quarterly for NKE: 0. Finnhub Basic Financials for NKE: OK.
2025-05-25 21:09:45,680 - root - INFO - stock_analyzer:350 - Calculating derived metrics for NKE...
2025-05-25 21:09:45,681 - root - INFO - stock_analyzer:298 - Using latest quarterly revenue: 35,212,000,000 (Source: Finnhub) for NKE.
2025-05-25 21:09:45,681 - root - INFO - stock_analyzer:370 - Calculated metrics for NKE: {
  "pe_ratio": 25.306645614035087,
  "pb_ratio": 9.996388080388082,
  "ps_ratio": 1.8526,
  "ev_to_sales": null,
  "ev_to_ebitda": null,
  "dividend_yield": 0.015036616136056905,
  "eps": 3.76,
  "net_profit_margin": null,
  "gross_profit_margin": null,
  "operating_profit_margin": 0.1302519372,
  "roe": 0.39501039501039503,
  "roa": 0.14956704277092628,
  "roic": 0.3444796354747266,
  "debt_to_equity": 0.8282744282744283,
  "current_ratio": 2.3961106391012934,
  "quick_ratio": 1.5112810346455205,
  "debt_to_ebitda": 1.6704402515723271,
  "revenue_growth_yoy": 0.0028310912392369722,
  "eps_growth_yoy": 0.14984709480122316,
  "revenue_growth_cagr_3yr": 0.04861491256483208,
  "eps_growth_cagr_3yr": -0.009180522194930263,
  "revenue_growth_cagr_5yr": 0.08251487385466705,
  "eps_growth_cagr_5yr": 0.23239537592729897,
  "revenue_growth_qoq": 0.47065948293864596,
  "free_cash_flow_per_share": 4.475599946941684,
  "free_cash_flow_yield": 0.07456847629026464,
  "free_cash_flow_trend": "Growing",
  "retained_earnings_trend": "Declining"
}
2025-05-25 21:09:45,683 - root - INFO - stock_analyzer:375 - Performing simplified DCF analysis for NKE...
2025-05-25 21:09:45,684 - root - INFO - stock_analyzer:426 - DCF for NKE: Base IV/Share: 72.57, Upside: 20.92%
2025-05-25 21:09:45,684 - root - INFO - stock_analyzer:457 - Fetching and attempting to summarize latest 10-K for NKE
2025-05-25 21:09:46,180 - root - INFO - base_client:38 - Cache hit for: GET:https://data.sec.gov/submissions/CIK0000320187.json?...
2025-05-25 21:09:46,765 - root - INFO - sec_edgar_client:127 - Fetching filing text from: https://www.sec.gov/Archives/edgar/data/320187/000032018724000044/nke-20240531.htm
2025-05-25 21:09:48,661 - root - WARNING - base_client:122 - HTTP error on attempt 1/3 for GET https://data.sec.gov/submissions/https://www.sec.gov/Archives/edgar/data/320187/000032018724000044/nke-20240531.htm (Params: {}, Headers: {'User-Agent': 'FinancialAnalysisBot/1.0 YourCompanyName YourContactEmail@example.com', 'Accept-Encoding': 'gzip, deflate'}): 404 - <?xml version="1.0" encoding="UTF-8"?>
<Error><Code>NoSuchKey</Code><Message>The specified key does not exist.</Message><Key>submissions/https:/www.sec.gov/Archives/edgar/data/320187/00003201872400004...
2025-05-25 21:09:48,661 - root - ERROR - base_client:143 - Non-retryable client error 404 for https://data.sec.gov/submissions/https://www.sec.gov/Archives/edgar/data/320187/000032018724000044/nke-20240531.htm: Unknown reason
2025-05-25 21:09:48,662 - root - WARNING - stock_analyzer:465 - Failed to fetch/load 10-K text from https://www.sec.gov/Archives/edgar/data/320187/000032018724000044/nke-20240531.htm
2025-05-25 21:09:48,663 - root - INFO - stock_analyzer:502 - Fetching and analyzing competitor data for NKE...
2025-05-25 21:09:48,911 - root - INFO - base_client:38 - Cache hit for: GET:https://finnhub.io/api/v1/stock/peers?symbol=NKE&token=d0o7hphr01qqr9alj38gd0o7hphr01qqr9alj390...
2025-05-25 21:09:50,494 - root - INFO - stock_analyzer:513 - Identified peers for NKE: ['DECK', 'SKX', 'CROX', 'SHOO', 'WWW']. Fetching basic data for comparison.
2025-05-25 21:09:50,745 - root - INFO - base_client:38 - Cache hit for: GET:https://financialmodelingprep.com/api/v3/profile/DECK?apikey=62ERGmJoqQgGD0nSGxRZS91TVzfz61uB...
2025-05-25 21:09:52,579 - root - INFO - base_client:38 - Cache hit for: GET:https://financialmodelingprep.com/api/v3/key-metrics/DECK?apikey=62ERGmJoqQgGD0nSGxRZS91TVzfz61u...
2025-05-25 21:09:54,675 - root - INFO - base_client:38 - Cache hit for: GET:https://finnhub.io/api/v1/stock/metric?metric=all&symbol=DECK&token=d0o7hphr01qqr9alj38gd0o7hphr...
2025-05-25 21:09:56,509 - root - INFO - base_client:38 - Cache hit for: GET:https://financialmodelingprep.com/api/v3/profile/SKX?apikey=62ERGmJoqQgGD0nSGxRZS91TVzfz61uB...
2025-05-25 21:09:58,343 - root - INFO - base_client:38 - Cache hit for: GET:https://financialmodelingprep.com/api/v3/key-metrics/SKX?apikey=62ERGmJoqQgGD0nSGxRZS91TVzfz61uB...
2025-05-25 21:10:00,440 - root - INFO - base_client:38 - Cache hit for: GET:https://finnhub.io/api/v1/stock/metric?metric=all&symbol=SKX&token=d0o7hphr01qqr9alj38gd0o7hphr0...
2025-05-25 21:10:02,273 - root - INFO - base_client:38 - Cache hit for: GET:https://financialmodelingprep.com/api/v3/profile/CROX?apikey=62ERGmJoqQgGD0nSGxRZS91TVzfz61uB...
2025-05-25 21:10:04,106 - root - INFO - base_client:38 - Cache hit for: GET:https://financialmodelingprep.com/api/v3/key-metrics/CROX?apikey=62ERGmJoqQgGD0nSGxRZS91TVzfz61u...
2025-05-25 21:10:06,189 - root - INFO - base_client:38 - Cache hit for: GET:https://finnhub.io/api/v1/stock/metric?metric=all&symbol=CROX&token=d0o7hphr01qqr9alj38gd0o7hphr...
2025-05-25 21:10:08,023 - root - INFO - base_client:38 - Cache hit for: GET:https://financialmodelingprep.com/api/v3/profile/SHOO?apikey=62ERGmJoqQgGD0nSGxRZS91TVzfz61uB...
2025-05-25 21:10:09,857 - root - INFO - base_client:38 - Cache hit for: GET:https://financialmodelingprep.com/api/v3/key-metrics/SHOO?apikey=62ERGmJoqQgGD0nSGxRZS91TVzfz61u...
2025-05-25 21:10:11,952 - root - INFO - base_client:38 - Cache hit for: GET:https://finnhub.io/api/v1/stock/metric?metric=all&symbol=SHOO&token=d0o7hphr01qqr9alj38gd0o7hphr...
2025-05-25 21:10:13,787 - root - INFO - base_client:38 - Cache hit for: GET:https://financialmodelingprep.com/api/v3/profile/WWW?apikey=62ERGmJoqQgGD0nSGxRZS91TVzfz61uB...
2025-05-25 21:10:15,620 - root - INFO - base_client:38 - Cache hit for: GET:https://financialmodelingprep.com/api/v3/key-metrics/WWW?apikey=62ERGmJoqQgGD0nSGxRZS91TVzfz61uB...
2025-05-25 21:10:17,798 - root - INFO - base_client:38 - Cache hit for: GET:https://finnhub.io/api/v1/stock/metric?metric=all&symbol=WWW&token=d0o7hphr01qqr9alj38gd0o7hphr0...
2025-05-25 21:10:26,214 - root - INFO - stock_analyzer:548 - Competitor analysis summary generated for NKE.
2025-05-25 21:10:26,214 - root - INFO - stock_analyzer:570 - Synthesizing investment thesis for NKE...
2025-05-25 21:10:26,215 - root - ERROR - stock_analyzer:627 - CRITICAL error in full analysis pipeline for NKE: Invalid format specifier '.2% if s['upside'] is not None else 'N/A'' for object of type 'float'
Traceback (most recent call last):
  File "C:\GitHub\stock-alarm\services\stock_analyzer.py", line 607, in analyze
    final_data_for_db.update(self._determine_investment_thesis())
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\GitHub\stock-alarm\services\stock_analyzer.py", line 582, in _determine_investment_thesis
    prompt += "- DCF Sensitivity Highlights:\n"; [prompt := prompt + f"  - {s['scenario']}: IV {s['intrinsic_value']:.2f} (Upside: {s['upside']:.2% if s['upside'] is not None else 'N/A'})\n" for s in dcf_results["dcf_assumptions"]["sensitivity_analysis"][:2]]
                                                                                                                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ValueError: Invalid format specifier '.2% if s['upside'] is not None else 'N/A'' for object of type 'float'
2025-05-25 21:10:26,217 - root - INFO - stock_analyzer:629 - Rolled back DB transaction for NKE due to error.
2025-05-25 21:10:26,218 - root - WARNING - main:25 - Stock analysis for NKE did not return a result object.
2025-05-25 21:10:31,221 - root - INFO - main:108 - --- Main script execution finished. ---
2025-05-25 21:10:31,221 - root - INFO - main:118 - Financial Analysis Script finished at 2025-05-25 18:10:31 UTC
2025-05-25 21:10:31,222 - root - INFO - main:119 - Total execution time: 0:01:52.419651
2025-05-25 21:10:31,222 - root - INFO - main:120 - ===================================================================
2025-05-25 21:11:22,803 - root - INFO - main:113 - ===================================================================
2025-05-25 21:11:22,803 - root - INFO - main:114 - Starting Financial Analysis Script at 2025-05-25 18:11:22 UTC
2025-05-25 21:11:22,803 - root - INFO - main:115 - ===================================================================
2025-05-25 21:11:22,805 - root - INFO - main:54 - --- Generating Today's Email Summary ---
2025-05-25 21:11:24,641 - root - INFO - main:61 - Found 0 stock analyses, 0 IPO analyses, 0 news analyses since 2025-05-25 00:00:00 UTC for email.
2025-05-25 21:11:24,642 - root - INFO - main:63 - No new analyses performed recently to include in the email summary.
2025-05-25 21:11:24,726 - root - INFO - main:108 - --- Main script execution finished. ---
2025-05-25 21:11:24,727 - root - INFO - main:118 - Financial Analysis Script finished at 2025-05-25 18:11:24 UTC
2025-05-25 21:11:24,728 - root - INFO - main:119 - Total execution time: 0:00:01.924492
2025-05-25 21:11:24,729 - root - INFO - main:120 - ===================================================================
